<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê²¬ì ì„œ ë³´ê¸°</title>
  
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-5V8D4NBW56"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-5V8D4NBW56');
  </script>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #f0f4f9 0%, #e8f4fd 100%);
      line-height: 1.4;
      min-height: 100vh;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.08);
      overflow: hidden;
      border: 1px solid #e1e8ed;
    }

    .header {
      text-align: center;
      padding: 30px 20px;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      border-bottom: 1px solid #e1e8ed;
    }

    .header h1 {
      margin: 0;
      color: #2c3e50;
      font-size: 1.8rem;
      font-weight: 800;
    }

    .quote-content {
      padding: 32px 20px;
    }

    .quote-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 24px;
      padding-bottom: 18px;
      border-bottom: 1px solid #e1e8ed;
    }

    .company-info {
      flex: 1;
    }

    .company-info h2 {
      margin: 0 0 12px 0;
      color: #1976d2;
      font-size: 1.6rem;
      font-weight: 800;
    }

    .company-info p {
      margin: 6px 0;
      color: #6c757d;
      font-size: 0.95rem;
    }

    .quote-info {
      text-align: right;
    }

    .quote-info h4 {
      margin: 0 0 12px 0;
      color: #2c3e50;
      font-size: 1.2rem;
      font-weight: 700;
    }

    .quote-info p {
      margin: 6px 0;
      color: #6c757d;
      font-size: 0.95rem;
    }

    .customer-info {
      margin-bottom: 24px;
      padding: 18px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 3px solid #1976d2;
    }

    .customer-info h4 {
      margin: 0 0 18px 0;
      color: #2c3e50;
      font-size: 1.2rem;
      font-weight: 700;
    }

    .customer-details p {
      margin: 6px 0;
      font-size: 0.95rem;
      color: #495057;
    }

    .customer-details strong {
      color: #1976d2;
      font-weight: 600;
    }

    .products-section {
      margin-bottom: 24px;
    }

    .products-section h4 {
      margin: 0 0 14px 0;
      color: #2c3e50;
      font-size: 1.1rem;
      font-weight: 700;
    }

    .products-table {
      width: 100%;
      border-collapse: collapse;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }

    .products-table th {
      background: #1976d2;
      color: #fff;
      font-weight: 700;
      font-size: 0.95rem;
      padding: 14px 12px;
      text-align: left;
    }

    .products-table td {
      padding: 14px 12px;
      font-size: 0.95rem;
      color: #495057;
      background: #fff;
      border-bottom: 1px solid #e1e8ed;
    }

    .total-section {
      text-align: right;
      margin-top: 24px;
      padding-top: 24px;
      border-top: 2px solid #e1e8ed;
    }

    .total-row {
      display: flex;
      justify-content: space-between;
      margin: 12px 0;
      font-size: 1.3rem;
      font-weight: 800;
      color: #1976d2;
      border-top: 2px solid #1976d2;
      padding-top: 12px;
      margin-top: 18px;
    }

    .product-image-section {
      margin-top: 24px;
      padding: 20px;
      background: #f8f9fa;
      border: 2px solid #e1e8ed;
      border-radius: 8px;
    }

    .product-image-section h4 {
      margin: 0 0 12px 0;
      color: #2c3e50;
      font-size: 1.1rem;
      font-weight: 700;
    }

    .image-container {
      display: flex;
      gap: 20px;
    }

    .image-box {
      flex: 1;
    }

    .image-box h5 {
      margin: 0 0 8px 0;
      color: #2c3e50;
      font-size: 1rem;
      font-weight: 600;
    }

    .image-display {
      width: 100%;
      height: 120px;
      background: #fff;
      border: 1px solid #dee2e6;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .image-display img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 6px;
    }

    .notes-box {
      flex: 2;
    }

    .notes-box h5 {
      margin: 0 0 8px 0;
      color: #2c3e50;
      font-size: 1rem;
      font-weight: 600;
    }

    .notes-display {
      background: #fff;
      border: 1px solid #dee2e6;
      border-radius: 6px;
      padding: 15px;
      height: 120px;
      color: #495057;
      font-size: 0.95rem;
      line-height: 1.5;
      overflow-y: auto;
    }

    .actions {
      text-align: center;
      margin-top: 32px;
      padding-top: 24px;
      border-top: 1px solid #e1e8ed;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      margin: 0 8px;
      text-decoration: none;
      display: inline-block;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
    }

    .btn-secondary {
      background: #e1e8ed;
      color: #764ba2;
    }

    .error-message {
      text-align: center;
      padding: 40px 20px;
      color: #6c757d;
    }

    .loading {
      text-align: center;
      padding: 40px 20px;
      color: #6c757d;
    }

    @media (max-width: 768px) {
      body {
        padding: 10px;
      }
      
      .container {
        border-radius: 12px;
      }
      
      .header {
        padding: 20px 15px;
      }
      
      .header h1 {
        font-size: 1.4rem;
      }
      
      .quote-content {
        padding: 20px 15px;
      }
      
      .quote-header {
        flex-direction: column;
        gap: 18px;
      }
      
      .company-info h2 {
        font-size: 1.4rem;
      }
      
      .image-container {
        flex-direction: column;
        gap: 16px;
      }
      
      .btn {
        display: block;
        width: 100%;
        margin: 8px 0;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ê²¬ì ì„œ ë³´ê¸°</h1>
    </div>
    
    <div class="quote-content" id="quoteContent">
      <div class="loading">
        <p>ê²¬ì ì„œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
      </div>
    </div>
    
    <div class="actions" id="actions" style="display: none;">
      <div style="margin-bottom: 20px; padding: 16px; background: #f8f9fa; border-radius: 8px; border-left: 3px solid #007bff;">
        <h4 style="margin: 0 0 12px 0; color: #2c3e50; font-size: 1rem;">ğŸ“ í¼ í¬ê¸° ì„¤ì •</h4>
        <div style="display: flex; gap: 16px; align-items: center; flex-wrap: wrap; margin-bottom: 12px;">
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="radio" name="viewFormSize" value="auto" checked style="margin: 0;" onchange="changeFormSize('auto')">
            <span style="font-size: 0.9rem;">ìë™ í¬ê¸°</span>
          </label>
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="radio" name="viewFormSize" value="fixed" style="margin: 0;" onchange="changeFormSize('fixed')">
            <span style="font-size: 0.9rem;">ê³ ì • í¬ê¸° (A4)</span>
          </label>
        </div>
        <p style="margin: 0; font-size: 0.8rem; color: #6c757d;">ê³ ì • í¬ê¸°ë¡œ ì„¤ì •í•˜ë©´ ê²¬ì ì„œê°€ A4 ìš©ì§€ í¬ê¸°ì— ë§ì¶° í‘œì‹œë©ë‹ˆë‹¤.</p>
      </div>
      
      <button class="btn btn-primary" onclick="downloadPDF()">PDF ë‹¤ìš´ë¡œë“œ</button>
      <a href="ê²¬ì ì„œìƒì„±ì„ íƒ.html" class="btn btn-secondary">ìƒˆ ê²¬ì ì„œ ë§Œë“¤ê¸°</a>
    </div>
  </div>

  <script>
    // URLì—ì„œ ê²¬ì ì„œ ID ê°€ì ¸ì˜¤ê¸°
    function getQuoteId() {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get('id');
    }

    // ê²¬ì ì„œ ë°ì´í„° ë¡œë“œ
    function loadQuoteData() {
      const quoteId = getQuoteId();
      
      if (!quoteId) {
        showError('ê²¬ì ì„œ IDê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ê²¬ì ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      const sharedData = localStorage.getItem('sharedQuoteData');
      
      if (!sharedData) {
        showError('ê²¬ì ì„œ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      try {
        const quoteData = JSON.parse(sharedData);
        
        // IDê°€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
        if (quoteData.number !== quoteId) {
          showError('ê²¬ì ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }

        displayQuote(quoteData);
        
        // ê³µìœ ëœ ê²¬ì ì„œì˜ í¼ í¬ê¸° ì„¤ì •ì´ ìˆë‹¤ë©´ ì ìš©
        if (quoteData.formSize) {
          // ë¼ë””ì˜¤ ë²„íŠ¼ ì„¤ì •
          const radioButton = document.querySelector(`input[name="viewFormSize"][value="${quoteData.formSize}"]`);
          if (radioButton) {
            radioButton.checked = true;
          }
          
          // í¼ í¬ê¸° ì ìš©
          changeFormSize(quoteData.formSize);
        }
      } catch (error) {
        console.error('ê²¬ì ì„œ ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:', error);
        showError('ê²¬ì ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    }

    // ê²¬ì ì„œ í‘œì‹œ
    function displayQuote(data) {
      const quoteContent = document.getElementById('quoteContent');
      
      // í¼ í¬ê¸° ì„¤ì • í™•ì¸
      const formSize = data.formSize || 'auto';
      const containerStyle = formSize === 'fixed' ? 
        'border: 2px solid #1976d2; border-radius: 8px; padding: 16px; background: #ffffff; box-shadow: 0 4px 12px rgba(25, 118, 210, 0.1); width: 800px; max-width: 800px; height: 1131px; max-height: 1131px; overflow: hidden; box-sizing: border-box;' :
        'border: 2px solid #1976d2; border-radius: 8px; padding: 16px; background: #ffffff; box-shadow: 0 4px 12px rgba(25, 118, 210, 0.1);';
      
      quoteContent.innerHTML = `
        <div style="${containerStyle}">
          <div style="text-align: center; margin-bottom: 12px;">
            <h2 style="color: #1976d2; font-size: 3.6rem; font-weight: 800; margin: 0 0 8px 0; letter-spacing: 2px;">CUCKOO</h2>
            <hr style="border: none; height: 2px; background: #1976d2; margin: 0;">
          </div>
        
        <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
          <div style="flex: 1;">
            <h4 style="margin: 0 0 6px 0; color: #2c3e50; font-size: 0.95rem; font-weight: 700;">ê²¬ì ì„œ</h4>
            <p style="margin: 3px 0; font-size: 0.85rem; color: #495057;"><strong>ê²¬ì ë²ˆí˜¸:</strong> ${data.number}</p>
            <p style="margin: 3px 0; font-size: 0.85rem; color: #495057;"><strong>ê²¬ì ì¼:</strong> ${formatDate(data.date)}</p>
            <p style="margin: 3px 0; font-size: 0.85rem; color: #495057;"><strong>ìœ íš¨ê¸°ê°„:</strong> 30ì¼</p>
          </div>
          <div style="flex: 1; text-align: left;">
            <h4 style="margin: 0 0 6px 0; color: #2c3e50; font-size: 0.95rem; font-weight: 700;">íŒë§¤ì¸</h4>
            <p style="margin: 3px 0; font-size: 0.85rem; color: #495057;"><strong>ì´ë¦„:</strong> ${data.sellerName}</p>
            <p style="margin: 3px 0; font-size: 0.85rem; color: #495057;"><strong>ì „í™”:</strong> ${data.sellerPhone}</p>
            <p style="margin: 3px 0; font-size: 0.85rem; color: #495057;"><strong>ì´ë©”ì¼:</strong> ${data.sellerEmail}</p>
          </div>
        </div>

        <div style="margin-bottom: 12px;">
          <div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px; padding: 10px; margin: 4px 0;">
            <p style="margin: 3px 0; font-size: 0.85rem; color: #495057;"><strong>ê³ ê°ëª…:</strong> ${data.customerName} ë‹˜</p>
          </div>
        </div>

        <div style="margin-bottom: 20px;">
          <h4 style="margin: 0 0 8px 0; color: #2c3e50; font-size: 0.95rem; font-weight: 700;">ë Œíƒˆ ìƒí’ˆ</h4>
          <table class="products-table">
            <thead>
              <tr>
                <th>ìƒí’ˆëª…</th>
                <th>ëª¨ë¸</th>
                <th>ë Œíƒˆë£Œ</th>
                <th>ì˜ë¬´ì‚¬ìš©ê¸°ê°„</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>${data.calculatorData && data.calculatorData.category ? data.calculatorData.category : (data.productName || 'ì¿ ì¿  ì œí’ˆ')}</td>
                <td>${data.calculatorData && data.calculatorData.model ? data.calculatorData.model : (data.productModel || '-')}</td>
                <td>${data.calculatorData ? data.calculatorData.fee.toLocaleString() + 'ì›' : '0ì›'}</td>
                <td>${data.calculatorData ? data.calculatorData.period + 'ê°œì›”' : '36ê°œì›”'}</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div style="text-align: right; margin-top: 24px; padding-top: 24px; border-top: 2px solid #e1e8ed;">
          <div style="display: flex; justify-content: space-between; margin: 12px 0; font-size: 1.3rem; font-weight: 800; color: #1976d2; border-top: 2px solid #1976d2; padding-top: 12px; margin-top: 18px;">
            <span>ì´ ê²¬ì  ê¸ˆì•¡:</span>
            <span>${data.calculatorData ? data.calculatorData.fee.toLocaleString() + 'ì›' : '0ì›'}</span>
          </div>
        </div>

        ${data.productImage || data.specialNotes ? `
        <div class="product-image-section">
          <div class="image-container">
            ${data.productImage ? `
            <div class="image-box" style="flex: 1;">
              <h5>ìƒí’ˆ ì´ë¯¸ì§€</h5>
              <div class="image-display">
                <img src="${data.productImage}" alt="ìƒí’ˆ ì´ë¯¸ì§€">
              </div>
            </div>
            ` : ''}
            ${data.specialNotes ? `
            <div class="notes-box" style="flex: 1;">
              <h5>ì œí’ˆì„¤ëª… ë° í˜œíƒ</h5>
              <div class="notes-display">
                ${data.specialNotes}
              </div>
            </div>
            ` : ''}
          </div>
        </div>
        ` : ''}
        </div>
      `;

      // ì•¡ì…˜ ë²„íŠ¼ í‘œì‹œ
      document.getElementById('actions').style.display = 'block';
    }

    // ë‚ ì§œ í¬ë§·íŒ…
    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.getFullYear() + 'ë…„ ' + String(date.getMonth() + 1).padStart(2, '0') + 'ì›” ' + String(date.getDate()).padStart(2, '0') + 'ì¼';
    }

    // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
    function showError(message) {
      const quoteContent = document.getElementById('quoteContent');
      quoteContent.innerHTML = `
        <div class="error-message">
          <h3>ì˜¤ë¥˜</h3>
          <p>${message}</p>
          <a href="ê²¬ì ì„œìƒì„±ì„ íƒ.html" class="btn btn-primary" style="margin-top: 20px;">ìƒˆ ê²¬ì ì„œ ë§Œë“¤ê¸°</a>
        </div>
      `;
    }

    // PDF ë‹¤ìš´ë¡œë“œ
    function downloadPDF() {
      const quoteContent = document.getElementById('quoteContent');
      
      html2canvas(quoteContent, {
        scale: 2,
        useCORS: true,
        allowTaint: true
      }).then(canvas => {
        const imgData = canvas.toDataURL('image/png');
        const pdf = new window.jspdf.jsPDF('p', 'mm', 'a4');
        const pageWidth = 210;
        const pageHeight = 297;
        const pxPerMm = canvas.width / pageWidth;
        let imgWidth = pageWidth;
        let imgHeight = canvas.height / pxPerMm;
        
        if (imgHeight > pageHeight) {
          imgHeight = pageHeight;
          imgWidth = canvas.width / (canvas.height / pageHeight);
        }
        
        const x = (pageWidth - imgWidth) / 2;
        const y = (pageHeight - imgHeight) / 2;
        
        pdf.addImage(imgData, 'PNG', x, y, imgWidth, imgHeight);
        
        const quoteId = getQuoteId();
        pdf.save(`ê²¬ì ì„œ_${quoteId}.pdf`);
      });
    }

    // í¼ í¬ê¸° ë³€ê²½ í•¨ìˆ˜
    function changeFormSize(formSize) {
      const quoteContent = document.getElementById('quoteContent');
      const container = quoteContent.querySelector('div');
      
      if (formSize === 'fixed') {
        container.style.cssText = `
          border: 2px solid #1976d2; 
          border-radius: 8px; 
          padding: 16px; 
          background: #ffffff; 
          box-shadow: 0 4px 12px rgba(25, 118, 210, 0.1); 
          width: 800px; 
          max-width: 800px; 
          height: 1131px; 
          max-height: 1131px; 
          overflow: hidden; 
          box-sizing: border-box;
        `;
      } else {
        container.style.cssText = `
          border: 2px solid #1976d2; 
          border-radius: 8px; 
          padding: 16px; 
          background: #ffffff; 
          box-shadow: 0 4px 12px rgba(25, 118, 210, 0.1);
        `;
      }
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ê²¬ì ì„œ ë°ì´í„° ë¡œë“œ
    window.addEventListener('load', loadQuoteData);
  </script>
</body>
</html> 