# 백엔드 서버 실행 가이드

## 🚀 클라우드 서버 연결 완료

**API 키가 성공적으로 적용되었습니다!**

- **클라우드 서버 URL**: `https://api.cloudtype.io/api`
- **API 키**: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOiJtZHV5dmg2cDE1OGY3OTYzIiwiaWF0IjoxNzU0MTgzMDU5fQ.6qG_RQyQa4CaINZib7G3RCQD75PZ9x_i6jRgZZQ5ds0`
- **상태**: ✅ 웹앱에 적용 완료

이제 웹앱이 클라우드 서버와 연결되어 데이터를 저장하고 관리할 수 있습니다.

---

## 1. 환경 설정 (로컬 개발용)

### 1.1 환경 변수 파일 생성
프로젝트 루트에 `.env` 파일을 생성하고 다음 내용을 추가하세요:

```env
# 서버 설정
PORT=3000
NODE_ENV=development

# MongoDB 연결
MONGODB_URI=mongodb://localhost:27017/cuckoo_quotes

# JWT 시크릿 키 (실제 운영 시에는 복잡한 키로 변경)
JWT_SECRET=cuckoo_quotes_secret_key_2024

# 프론트엔드 URL (CORS 설정용)
FRONTEND_URL=http://localhost:5500

# 파일 업로드 설정
MAX_FILE_SIZE=5242880
UPLOAD_PATH=./uploads

# 로깅 설정
LOG_LEVEL=info
LOG_FILE=./logs/app.log

# 보안 설정
BCRYPT_ROUNDS=12
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

# API 설정
API_VERSION=v1
```

### 1.2 MongoDB 설치 및 실행
1. MongoDB를 설치하세요: https://www.mongodb.com/try/download/community
2. MongoDB 서비스를 시작하세요
3. 또는 Docker를 사용하여 MongoDB를 실행할 수 있습니다:
   ```bash
   docker run -d -p 27017:27017 --name mongodb mongo:latest
   ```

## 2. 의존성 설치

```bash
npm install
```

## 3. 서버 실행

### 3.1 개발 모드
```bash
npm run dev
```

### 3.2 프로덕션 모드
```bash
npm start
```

## 4. API 테스트

서버가 실행되면 다음 URL에서 API를 테스트할 수 있습니다:

- **서버 상태 확인**: http://localhost:3000/api/health
- **API 문서**: http://localhost:3000/api/docs (개발 중)

## 5. 주요 API 엔드포인트

### 5.1 인증 관련
- `POST /api/auth/register` - 회원가입
- `POST /api/auth/login` - 로그인
- `GET /api/auth/me` - 내 정보 조회
- `POST /api/auth/logout` - 로그아웃

### 5.2 견적서 관련
- `POST /api/quotes` - 견적서 생성
- `GET /api/quotes` - 견적서 목록 조회
- `GET /api/quotes/:id` - 견적서 상세 조회
- `PUT /api/quotes/:id` - 견적서 수정
- `DELETE /api/quotes/:id` - 견적서 삭제

### 5.3 사용자 관리 (관리자)
- `GET /api/users` - 사용자 목록
- `PUT /api/users/:id` - 사용자 정보 수정
- `PATCH /api/users/:id/toggle-status` - 사용자 활성화/비활성화

### 5.4 관리자 기능
- `GET /api/admin/dashboard` - 대시보드
- `GET /api/admin/system-status` - 시스템 상태

## 6. 프론트엔드 연결

### 6.1 로컬 개발 환경
1. Live Server 또는 유사한 도구로 프론트엔드를 실행하세요
2. 기본 포트는 5500을 권장합니다
3. 프론트엔드에서 `http://localhost:3000/api`로 백엔드에 접근합니다

### 6.2 API 설정 확인
`js/api-config.js` 파일에서 `BASE_URL`이 올바르게 설정되어 있는지 확인하세요:

```javascript
BASE_URL: 'http://localhost:3000/api'
```

## 7. 문제 해결

### 7.1 MongoDB 연결 오류
- MongoDB 서비스가 실행 중인지 확인
- 연결 문자열이 올바른지 확인
- 방화벽 설정 확인

### 7.2 CORS 오류
- `.env` 파일의 `FRONTEND_URL` 설정 확인
- 프론트엔드 URL이 올바른지 확인

### 7.3 JWT 토큰 오류
- `.env` 파일의 `JWT_SECRET` 설정 확인
- 토큰이 만료되지 않았는지 확인

## 8. 배포 고려사항

### 8.1 프로덕션 환경
- `NODE_ENV=production` 설정
- 강력한 `JWT_SECRET` 사용
- HTTPS 설정
- 로그 파일 관리
- 백업 전략 수립

### 8.2 보안 설정
- 환경 변수 보안
- API 키 관리
- 요청 제한 설정
- 입력 데이터 검증

## 9. 모니터링

### 9.1 로그 확인
```bash
tail -f logs/app.log
```

### 9.2 성능 모니터링
- MongoDB 쿼리 성능
- API 응답 시간
- 메모리 사용량
- CPU 사용량

## 10. 추가 개발

### 10.1 새로운 API 추가
1. `routes/` 폴더에 새 라우트 파일 생성
2. `server.js`에 라우트 등록
3. 필요한 모델 및 미들웨어 추가

### 10.2 데이터베이스 스키마 변경
1. `models/` 폴더의 스키마 파일 수정
2. 마이그레이션 스크립트 작성 (필요시)
3. API 응답 형식 업데이트

---

## 🎉 클라우드 서버 연결 완료!

### 현재 상태
- ✅ API 키가 웹앱에 적용됨
- ✅ 클라우드 서버 URL 설정 완료
- ✅ 자동 인증 헤더 설정 완료
- ✅ 사용자 토큰 관리 시스템 구축

### 테스트 방법
1. `API_테스트.html` 페이지를 열어 클라우드 서버 연결 상태를 확인하세요
2. 웹앱에서 로그인/회원가입을 테스트해보세요
3. 견적서 생성 기능을 테스트해보세요

### 주의사항
- 클라우드 서버는 24/7 운영되므로 별도의 서버 실행이 필요하지 않습니다
- API 키는 보안을 위해 안전하게 관리하세요
- 데이터는 클라우드 서버에 자동으로 저장됩니다 